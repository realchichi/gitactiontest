{% extends "base.html" %}

{% block content %}
<div>
    <div id="edit_container" style="display:none;">
    <label>Edit Box</label>
    <input type="text" name="edit" id="edit" c="">
    <button id="submitt" >submit</button>
  </div>
  <div id="commu_container">
      
  </div>
</div>


<script >
	function handleClickEdit(element) {
		var input = document.getElementById("edit")
        var value = element.getAttribute("value");

        var x = value.split(',')
        var check = [x[0],x[1]]

        $("#edit_container").toggle("fast")
        $("#edit").attr("c", check);
        $('#edit').val(x[2]);
      }
    $("#submitt").click(function(){

    	var y = $("#edit").val()
    	var cValue = $("#edit").attr("c");
    	var list_c = cValue.split(",")
    	data = {"message":y ,"id":list_c[0] ,"account_id":list_c[1]}
    	$.post("/edit/commu",data,function (edit_commu){
        	location.reload()
    	})
    })
	function handleClickDelete(element) {
      var value = element.getAttribute("value");
      value = value.split(",")
      let data = {"id":value[0] , "account_id":value[1]}
      if (!confirm("Delete " + "sure" + '?')) {
      return false;
    }

    // console.log(value)
      $.post("/delete/commu", data, function (data_commu) {
        location.reload()
      });
    }
  
	function createbox(data){
        for(let i=0;i<data.length;i++){
            if(!(data[i]["removed_date"])){
                var x =`<div id="box_add_history">
                          <img src ="`+data[i]["avatar_url"]+` width=50"<br>
                          <p>Name :`+data[i]["name_user"]+`</p>
                           <p id="shared_date">Shared date :`+ data[i]["shared_date"]+`</p>
                           <p id="edited_date">Updated date :`+ data[i]["edited_date"]+`</p>
                          <button id="plant_ifo" value="`+[data[i]["id"],data[i]["img"].slice(4),data[i]["plant_name"]]+`" onclick="go_to_comment(this)">
                            <img src ="`+data[i]["img"].slice(4)+`" width=100 >
                          </button>
                          <div id="data">
                            <p>Message :</p>
                            <p>`+data[i]["message"]+`</p>
                           
                            <a id="delete_button" value="`+[data[i]["id"],data[i]["account_id"]]+`" onclick="handleClickDelete(this)">üóëÔ∏è</a>
                            <a id="edit_button" value="`+[data[i]["id"],data[i]["account_id"],data[i]["message"]]+`" onclick="handleClickEdit(this)">‚úèÔ∏è</a>
                          </div>
                        </div>
                        `

              $("#commu_container").prepend(x);
            }
            
        }
    }
    function go_to_comment(element){
      var x =element.split(",")
      var data={"comment_id":x[0],"plant_img":x[1],"plant_name":x[2]}
      $.post("/comment/data", data, function (data_commu){
        // window.location.href = "comment.html";
      })
    }
    function commentna(datay){
      var value = document.getElementById("input"+datay.value+"").value
      var data={"history_id":datay.value,"message":value}
      $.post("/comment/add",data,function(data){
        location.reload()
      })
    }
    // $("#submit_comment").click(function(){
    //   console.log("llll")
    // // console.log(this.value)
    // })
    $(document).ready(function () {
        $.getJSON("/history/data", function (data) {

            createbox(data);
            // console.log(data)
      })
      //   $.getJSON("/commu/data", function (data) {

      //       createbox(data);
      // })
    });

</script>
{% endblock %}