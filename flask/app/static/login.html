<!DOCTYPE html>
<html>
  <head>
    <title>Google+ Login Custom Button</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" href="static/css/csss.css"> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/express/4.17.1/express.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cors/2.8.5/cors.js"></script>
  </head>

  <body>
    <div class="login_box">
      <form onsubmit="return login()">
          <label >Email address</label>
          <input type="email" class="form-control" id="username" placeholder="name@example.com">
          <label >Password</label>
          <input type="password" class="form-control" id="password" placeholder="Password">
          
    
        <button class="w-100 btn btn-lg btn-primary mt-3" type="submit">Login</button>
      </form>
      <div id="img"></div>
      <button onclick="checkFbLoginState();">Login with Facebook</button>
      <br>
    </div>

    <script>

        window.fbAsyncInit = function() {
    FB.init({
      appId      : '2498763683629022',
      cookie     : true,
      xfbml      : true,
      version    : 'v3.1'
    });

    FB.AppEvents.logPageView();

  };
  
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
        
      
      var fbLoginStatus = false;
      function checkFbLoginState() {
        FB.getLoginStatus(function(response) {
          statusChangeCallback(response);
        });
      }

      function statusChangeCallback(response) {
        if(fbLoginStatus == false) {  
          if (response.status == 'connected') {
            fbLoginStatus = true;

          } else {
            FB.login(function(response) {
              if (response.authResponse){
                fbLoginStatus = true;

                getCurrentUserInfo(response);
              } else {
                console.log('Auth failed.');
              }
            }, {scope: 'public_profile'});
          }
        } 
      }
      function getCurrentUserInfo(response) {   
          FB.api('/me?fields=name,email,first_name,last_name,id', function(userInfo) {
            console.log(userInfo);
            const profilePictureUrl =  "https://graph.facebook.com/"+response.authResponse.userID+"/picture?type=large&access_token="+response.authResponse.accessToken
            const img = document.createElement('img');
            img.src = profilePictureUrl;
            img.alt = 'Profile Picture';
            document.getElementById('img').appendChild(img);
  });   


      }
    var jwt = localStorage.getItem("jwt");
    const express = require('express');
    const cors = require('cors');
    const app = express();
    app.use(cors());
      function loadUser() {
      const xhttp = new XMLHttpRequest();
      xhttp.open("POST", "https://www.mecallapi.com/api/auth/user");
      xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
      xhttp.setRequestHeader("Authorization", "Bearer "+jwt);
      xhttp.send(JSON.stringify({
    "username": username,
    "password": password
  }));
      xhttp.onreadystatechange = function() {

        if (this.readyState == 4) {
          console.log("00000"+this.responseText,objects)
          const objects = JSON.parse(this.responseText);
          

          if (objects["status"] == "ok") {
            const user = objects["user"]
            console.log(user)
          }
        }
      };
}

loadUser();

    </script>
    
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.16/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>

  </body>
</html>